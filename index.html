<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂØ∂ÂèØÂ§¢99‰πòÊ≥ïË°®ÈÅäÊà≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .game-container {
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
        }
        
        .title {
            color: #2d3436;
            font-size: 2.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .stat {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .main-area {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
            align-items: flex-start;
        }
        
        .left-section {
            flex: 1;
        }
        
        .right-section {
            flex: 0 0 320px;
            min-height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .question-box {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 40px 30px;
            border-radius: 25px;
            border: 4px solid #667eea;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }
        
        .question-text {
            font-size: 3.5rem;
            color: #2d3436;
            margin-bottom: 25px;
            font-weight: bold;
        }
        
        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .answer-input {
            font-size: 2.2rem;
            padding: 20px 25px;
            border: 4px solid #ddd;
            border-radius: 15px;
            width: 200px;
            text-align: center;
            font-weight: bold;
            background: white;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 20px 30px;
            font-size: 1.6rem;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
        }
        
        .message {
            font-size: 1.4rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            font-weight: bold;
            display: none;
        }
        
        .message.correct {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
        }
        
        .message.incorrect {
            background: linear-gradient(45deg, #ff7675, #fd79a8);
            color: white;
        }
        
        .pokemon-reward {
            width: 100%;
        }
        
        .pokemon-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            transform: scale(0);
            transition: transform 0.6s ease;
            width: 100%;
            max-width: 300px;
        }
        
        .pokemon-card.show {
            transform: scale(1);
            animation: bounceIn 0.8s ease;
        }
        
        @keyframes bounceIn {
            0%, 20%, 60%, 100% { transform: scale(1); }
            40% { transform: scale(1.15); }
            80% { transform: scale(1.05); }
        }
        
        .pokemon-image {
            width: 120px;
            height: 120px;
            margin-bottom: 10px;
            image-rendering: pixelated;
        }
        
        .pokemon-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .pokemon-type {
            padding: 8px 15px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .collection {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #ddd;
        }
        
        .collection-title {
            font-size: 1.4rem;
            color: #2d3436;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .type-collections {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .type-collection {
            background: white;
            border-radius: 12px;
            padding: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .type-collection.complete {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            border-color: #f39c12;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }
        
        .type-collection.legendary {
            background: linear-gradient(45deg, #4a4a80, #3d3d6b);
            border-color: #9b59b6;
            color: white;
        }
        
        .type-collection.legendary.complete {
            background: linear-gradient(45deg, #fd79a8, #fdcb6e, #4a4a80);
            border-color: #e84393;
            box-shadow: 0 0 25px rgba(232, 67, 147, 0.8);
            animation: legendaryGlow 2s infinite alternate;
        }
        
        @keyframes legendaryGlow {
            0% { box-shadow: 0 0 25px rgba(232, 67, 147, 0.8); }
            100% { box-shadow: 0 0 35px rgba(74, 74, 128, 0.8); }
        }
        
        .type-header {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
            justify-items: center;
        }
        
        .pokemon-mini {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            image-rendering: pixelated;
            filter: grayscale(100%) brightness(0.5);
            transition: all 0.3s ease;
        }
        
        .pokemon-mini.collected {
            filter: none;
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .stars {
            font-size: 1.8rem;
            margin-top: 15px;
        }
        
        .star {
            color: #f39c12;
            margin: 0 3px;
            animation: twinkle 1.5s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(10deg); }
        }
        
        @media (max-width: 768px) {
            .title { font-size: 1.8rem; }
            .main-area {
                flex-direction: column;
                gap: 20px;
            }
            .right-section {
                flex: none;
                min-height: auto;
            }
            .question-box { padding: 30px 20px; }
            .question-text { font-size: 2.5rem; }
            .answer-input { 
                width: 160px; 
                font-size: 1.8rem; 
            }
            .submit-btn {
                font-size: 1.4rem;
                padding: 18px 25px;
            }
            .input-area { 
                flex-direction: column; 
                gap: 15px;
            }
            .stats { 
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            .type-collections {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .question-text { font-size: 2rem; }
            .answer-input { 
                width: 140px; 
                font-size: 1.6rem; 
            }
            .submit-btn { font-size: 1.2rem; }
            .type-collections { 
                grid-template-columns: 1fr; 
            }
            .pokemon-grid {
                grid-template-columns: repeat(10, 1fr);
            }
            .pokemon-mini {
                width: 16px;
                height: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title">üéÆ ÂØ∂ÂèØÂ§¢‰πòÊ≥ïÂ§ßÂ∏´</h1>
        
        <div class="stats">
            <div class="stat">üìä Á≠îÂ∞ç <span id="correctCount">0</span> È°å</div>
            <div class="stat">üìù ÈÄ≤Â∫¶ <span id="progressCount">0</span>/81</div>
            <div class="stat">üéØ ÂØ∂ÂèØÂ§¢ <span id="pokemonCount">0</span> Èöª</div>
            <div class="stat">‚≠ê ÊòüÊòü <span id="starCount">0</span> È°Ü</div>
        </div>
        
        <div class="main-area">
            <div class="left-section">
                <div class="question-box">
                    <div class="question-text" id="questionText">2 √ó 3 = ?</div>
                    <div class="input-area">
                        <input type="number" id="answerInput" class="answer-input" placeholder="?">
                        <button onclick="checkAnswer()" class="submit-btn">Á¢∫Ë™ç</button>
                    </div>
                </div>
                <div id="message" class="message"></div>
            </div>
            
            <div class="right-section">
                <div class="pokemon-reward" id="pokemonReward"></div>
            </div>
        </div>
        
        <div class="collection">
            <h3 class="collection-title">üìö ÂØ∂ÂèØÂ§¢Êî∂ÈõÜÂÜä - ÊØèÁ≥ªÂàóÊî∂ÈõÜ5ÈöªÁç≤ÂæóÊòüÊòü | üåü Á•ûË©±Á®ÆÁ®ÄÊúâÂá∫Áèæ</h3>
            <div class="type-collections" id="typeCollections"></div>
            <div class="stars" id="starsDisplay"></div>
        </div>
    </div>

    <script>
        // ÈÅäÊà≤ÁãÄÊÖã
        let stats = {
            correct: 0,
            pokemon: 0,
            stars: 0
        };
        
        let currentQuestion = {};
        
        // ÂùáÂãªÈ°åÁõÆÊ±† - Á¢∫‰øùÊØèÂÄãÈ°åÁõÆÈÉΩÁ∑¥ÁøíÂà∞
        let questionPool = [];
        let usedQuestions = [];
        
        // ÂØ∂ÂèØÂ§¢Ë≥áÊñô - ÊØèÁ®ÆÂ±¨ÊÄß20ÈöªÔºåÊî∂ÈõÜ‰ªªÊÑè5ÈöªÁç≤ÂæóÊòüÊòü
        const pokemonTypes = {
            fire: {
                name: 'ÁÅ´Á≥ª',
                color: '#ff6b6b',
                pokemon: [
                    {id: 4, name: 'charmander', nameCH: 'Â∞èÁÅ´Èæç'},
                    {id: 5, name: 'charmeleon', nameCH: 'ÁÅ´ÊÅêÈæç'},
                    {id: 6, name: 'charizard', nameCH: 'Âô¥ÁÅ´Èæç'},
                    {id: 37, name: 'vulpix', nameCH: 'ÂÖ≠Â∞æ'},
                    {id: 38, name: 'ninetales', nameCH: '‰πùÂ∞æ'},
                    {id: 58, name: 'growlithe', nameCH: 'Âç°ËíÇÁãó'},
                    {id: 59, name: 'arcanine', nameCH: 'È¢®ÈÄüÁãó'},
                    {id: 77, name: 'ponyta', nameCH: 'Â∞èÁÅ´È¶¨'},
                    {id: 78, name: 'rapidash', nameCH: 'ÁÉàÁÑ∞È¶¨'},
                    {id: 126, name: 'magmar', nameCH: 'È¥®Âò¥ÁÅ´Áç∏'},
                    {id: 136, name: 'flareon', nameCH: 'ÁÅ´‰ºäÂ∏É'},
                    {id: 146, name: 'moltres', nameCH: 'ÁÅ´ÁÑ∞È≥•'},
                    {id: 155, name: 'cyndaquil', nameCH: 'ÁÅ´ÁêÉÈº†'},
                    {id: 156, name: 'quilava', nameCH: 'ÁÅ´Â≤©Èº†'},
                    {id: 157, name: 'typhlosion', nameCH: 'ÁÅ´ÁàÜÁç∏'},
                    {id: 218, name: 'slugma', nameCH: 'ÁÜîÂ≤©Ëü≤'},
                    {id: 219, name: 'magcargo', nameCH: 'ÁÜîÂ≤©Ëù∏Áâõ'},
                    {id: 240, name: 'magby', nameCH: 'È¥®Âò¥ÂØ∂ÂØ∂'},
                    {id: 244, name: 'entei', nameCH: 'ÁÇéÂ∏ù'},
                    {id: 250, name: 'ho-oh', nameCH: 'È≥≥Áéã'}
                ]
            },
            water: {
                name: 'Ê∞¥Á≥ª', 
                color: '#74b9ff',
                pokemon: [
                    {id: 7, name: 'squirtle', nameCH: 'ÂÇëÂ∞ºÈæú'},
                    {id: 8, name: 'wartortle', nameCH: 'Âç°Âí™Èæú'},
                    {id: 9, name: 'blastoise', nameCH: 'Ê∞¥ÁÆ≠Èæú'},
                    {id: 54, name: 'psyduck', nameCH: 'ÂèØÈÅîÈ¥®'},
                    {id: 55, name: 'golduck', nameCH: 'Âì•ÈÅîÈ¥®'},
                    {id: 72, name: 'tentacool', nameCH: 'Áë™ÁëôÊ∞¥ÊØç'},
                    {id: 73, name: 'tentacruel', nameCH: 'ÊØíÂà∫Ê∞¥ÊØç'},
                    {id: 79, name: 'slowpoke', nameCH: 'ÂëÜÂëÜÁç∏'},
                    {id: 80, name: 'slowbro', nameCH: 'ÂëÜÊÆºÁç∏'},
                    {id: 90, name: 'shellder', nameCH: 'Â§ßËàåË≤ù'},
                    {id: 91, name: 'cloyster', nameCH: 'Âà∫Áî≤Ë≤ù'},
                    {id: 98, name: 'krabby', nameCH: 'Â§ßÈâóËüπ'},
                    {id: 99, name: 'kingler', nameCH: 'Â∑®ÈâóËüπ'},
                    {id: 116, name: 'horsea', nameCH: 'Â¢®Êµ∑È¶¨'},
                    {id: 117, name: 'seadra', nameCH: 'Êµ∑Âà∫Èæç'},
                    {id: 118, name: 'goldeen', nameCH: 'ËßíÈáëÈ≠ö'},
                    {id: 119, name: 'seaking', nameCH: 'ÈáëÈ≠öÁéã'},
                    {id: 120, name: 'staryu', nameCH: 'Êµ∑ÊòüÊòü'},
                    {id: 121, name: 'starmie', nameCH: 'ÂØ∂Áü≥Êµ∑Êòü'},
                    {id: 129, name: 'magikarp', nameCH: 'ÈØâÈ≠öÁéã'}
                ]
            },
            grass: {
                name: 'ËçâÁ≥ª',
                color: '#55a3ff', 
                pokemon: [
                    {id: 1, name: 'bulbasaur', nameCH: 'Â¶ôËõôÁ®ÆÂ≠ê'},
                    {id: 2, name: 'ivysaur', nameCH: 'Â¶ôËõôËçâ'},
                    {id: 3, name: 'venusaur', nameCH: 'Â¶ôËõôËä±'},
                    {id: 43, name: 'oddish', nameCH: 'Ëµ∞Ë∑ØËçâ'},
                    {id: 44, name: 'gloom', nameCH: 'Ëá≠Ëá≠Ëä±'},
                    {id: 45, name: 'vileplume', nameCH: 'Èú∏ÁéãËä±'},
                    {id: 46, name: 'paras', nameCH: 'Ê¥æÊãâÊñØ'},
                    {id: 47, name: 'parasect', nameCH: 'Ê¥æÊãâÊñØÁâπ'},
                    {id: 69, name: 'bellsprout', nameCH: 'ÂñáÂè≠ËäΩ'},
                    {id: 70, name: 'weepinbell', nameCH: 'Âè£ÂëÜËä±'},
                    {id: 71, name: 'victreebel', nameCH: 'Â§ßÈ£üËä±'},
                    {id: 102, name: 'exeggcute', nameCH: 'ËõãËõã'},
                    {id: 103, name: 'exeggutor', nameCH: 'Ê§∞ËõãÊ®π'},
                    {id: 114, name: 'tangela', nameCH: 'ËîìËó§ÊÄ™'},
                    {id: 152, name: 'chikorita', nameCH: 'ËèäËçâËëâ'},
                    {id: 153, name: 'bayleef', nameCH: 'ÊúàÊ°ÇËëâ'},
                    {id: 154, name: 'meganium', nameCH: 'Â§ßÁ´∫Ëëµ'},
                    {id: 182, name: 'bellossom', nameCH: 'ÁæéÈ∫óËä±'},
                    {id: 187, name: 'hoppip', nameCH: 'ÊØΩÂ≠êËçâ'},
                    {id: 191, name: 'sunkern', nameCH: 'ÂêëÊó•Á®ÆÂ≠ê'}
                ]
            },
            electric: {
                name: 'ÈõªÁ≥ª',
                color: '#feca57',
                pokemon: [
                    {id: 25, name: 'pikachu', nameCH: 'ÁöÆÂç°‰∏ò'},
                    {id: 26, name: 'raichu', nameCH: 'Èõ∑‰∏ò'},
                    {id: 81, name: 'magnemite', nameCH: 'Â∞èÁ£ÅÊÄ™'},
                    {id: 82, name: 'magneton', nameCH: '‰∏âÂêà‰∏ÄÁ£ÅÊÄ™'},
                    {id: 100, name: 'voltorb', nameCH: 'Èõ∑ÈõªÁêÉ'},
                    {id: 101, name: 'electrode', nameCH: 'È†ëÁöÆÈõ∑ÂΩà'},
                    {id: 125, name: 'electabuzz', nameCH: 'ÈõªÊìäÁç∏'},
                    {id: 135, name: 'jolteon', nameCH: 'Èõ∑‰ºäÂ∏É'},
                    {id: 145, name: 'zapdos', nameCH: 'ÈñÉÈõªÈ≥•'},
                    {id: 172, name: 'pichu', nameCH: 'ÁöÆ‰∏ò'},
                    {id: 179, name: 'mareep', nameCH: 'Âí©Âà©Áæä'},
                    {id: 180, name: 'flaaffy', nameCH: 'Ëå∏Ëå∏Áæä'},
                    {id: 181, name: 'ampharos', nameCH: 'ÈõªÈæç'},
                    {id: 239, name: 'elekid', nameCH: 'ÈõªÊìäÊÄ™'},
                    {id: 243, name: 'raikou', nameCH: 'Èõ∑ÂÖ¨'},
                    {id: 309, name: 'electrike', nameCH: 'ËêΩÈõ∑Áç∏'},
                    {id: 310, name: 'manectric', nameCH: 'Èõ∑ÈõªÁç∏'},
                    {id: 311, name: 'plusle', nameCH: 'Ê≠£ÈõªÊãçÊãç'},
                    {id: 312, name: 'minun', nameCH: 'Ë≤†ÈõªÊãçÊãç'},
                    {id: 466, name: 'electivire', nameCH: 'ÈõªÊìäÈ≠îÁç∏'}
                ]
            },
            legendary: {
                name: 'Á•ûË©±Á®Æ',
                color: '#9b59b6',
                pokemon: [
                    {id: 144, name: 'articuno', nameCH: 'ÊÄ•ÂáçÈ≥•'},
                    {id: 145, name: 'zapdos', nameCH: 'ÈñÉÈõªÈ≥•'},
                    {id: 146, name: 'moltres', nameCH: 'ÁÅ´ÁÑ∞È≥•'},
                    {id: 150, name: 'mewtwo', nameCH: 'Ë∂ÖÂ§¢'},
                    {id: 151, name: 'mew', nameCH: 'Â§¢Âπª'},
                    {id: 243, name: 'raikou', nameCH: 'Èõ∑ÂÖ¨'},
                    {id: 244, name: 'entei', nameCH: 'ÁÇéÂ∏ù'},
                    {id: 245, name: 'suicune', nameCH: 'Ê∞¥Âêõ'},
                    {id: 249, name: 'lugia', nameCH: 'Ê¥õÂ•á‰∫û'},
                    {id: 250, name: 'ho-oh', nameCH: 'È≥≥Áéã'},
                    {id: 251, name: 'celebi', nameCH: 'ÊôÇÊãâÊØî'},
                    {id: 380, name: 'latias', nameCH: 'ÊãâÂ∏ù‰∫ûÊñØ'},
                    {id: 381, name: 'latios', nameCH: 'ÊãâÂ∏ùÊ≠êÊñØ'},
                    {id: 382, name: 'kyogre', nameCH: 'ËìãÊ≠êÂç°'},
                    {id: 383, name: 'groudon', nameCH: 'Âõ∫ÊãâÂ§ö'},
                    {id: 384, name: 'rayquaza', nameCH: 'ÁÉàÁ©∫Âùê'},
                    {id: 385, name: 'jirachi', nameCH: 'Âü∫ÊãâÁ•à'},
                    {id: 386, name: 'deoxys', nameCH: '‰ª£Ê≠êÂ•áÂ∏åÊñØ'},
                    {id: 483, name: 'dialga', nameCH: 'Â∏ùÁâôÁõßÂç°'},
                    {id: 484, name: 'palkia', nameCH: 'Â∏ïË∑ØÂ•á‰∫û'}
                ]
            }
        };
        
        // Êî∂ÈõÜÈÄ≤Â∫¶
        let collection = {
            fire: [],
            water: [], 
            grass: [],
            electric: [],
            legendary: []
        };
        
        // Áç≤ÂèñÂØ∂ÂèØÂ§¢ÂúñÁâáURL - ‰ΩøÁî®Â§öÈáçÂÇôÊ°à
        function getPokemonImageURL(id, isOfficial = true) {
            const paddedId = String(id).padStart(3, '0');
            if (isOfficial) {
                return `https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/${paddedId}.png`;
            }
            return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
        }
        
        // ËôïÁêÜÂúñÁâáËºâÂÖ•ÈåØË™§ÁöÑÂáΩÊï∏
        function handleImageError(img, id) {
            if (img.src.includes('HybridShivam')) {
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
            } else if (img.src.includes('sprites/pokemon')) {
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${id}.png`;
            } else {
                img.style.display = 'none';
                img.parentElement.innerHTML += '<div style="font-size: 1rem;">‚ùì</div>';
            }
        }
        
        // ÂàùÂßãÂåñÈ°åÁõÆÊ±†
        function initQuestionPool() {
            questionPool = [];
            for (let i = 1; i <= 9; i++) {
                for (let j = 1; j <= 9; j++) {
                    questionPool.push({
                        num1: i,
                        num2: j,
                        answer: i * j
                    });
                }
            }
            // Êâì‰∫ÇÈ°åÁõÆÈ†ÜÂ∫è
            shuffleArray(questionPool);
        }
        
        // Êâì‰∫ÇÈô£ÂàóÈ†ÜÂ∫è
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // ÂàùÂßãÂåñÈÅäÊà≤
        function initGame() {
            initQuestionPool();
            generateQuestion();
            updateStats();
            renderCollection();
            
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        }
        
        // ÁîüÊàêÂïèÈ°å - ÂùáÂãªÊ®°Âºè
        function generateQuestion() {
            // Â¶ÇÊûúÈ°åÁõÆÊ±†Áî®ÂÆå‰∫ÜÔºåÈáçÊñ∞ÂàùÂßãÂåñ
            if (questionPool.length === 0) {
                initQuestionPool();
                usedQuestions = [];
                showMessage('üéâ ÊÅ≠ÂñúÔºÅÂÆåÊàê‰∏ÄËº™99‰πòÊ≥ïË°®Á∑¥ÁøíÔºÅÈñãÂßãÊñ∞‰∏ÄËº™ÔºÅ', 'correct');
                setTimeout(() => {
                    document.getElementById('message').style.display = 'none';
                }, 3000);
            }
            
            // ÂæûÈ°åÁõÆÊ±†‰∏≠ÂèñÂá∫‰∏ÄÂÄãÈ°åÁõÆ
            const questionIndex = Math.floor(Math.random() * questionPool.length);
            currentQuestion = questionPool[questionIndex];
            
            // Â∞áÈ°åÁõÆÂæûÊ±†‰∏≠ÁßªÈô§ÔºåÂä†ÂÖ•Â∑≤Áî®È°åÁõÆ
            questionPool.splice(questionIndex, 1);
            usedQuestions.push(currentQuestion);
            
            document.getElementById('questionText').textContent = `${currentQuestion.num1} √ó ${currentQuestion.num2} = ?`;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
        }
        
        // Ê™¢Êü•Á≠îÊ°à
        function checkAnswer() {
            const userAnswer = parseInt(document.getElementById('answerInput').value);
            
            if (isNaN(userAnswer)) {
                showMessage('Ë´ãËº∏ÂÖ•Êï∏Â≠óÔºÅ', 'incorrect');
                return;
            }
            
            if (userAnswer === currentQuestion.answer) {
                stats.correct++;
                showMessage('üéâ Á≠îÂ∞ç‰∫ÜÔºÅÂ§™Ê£í‰∫ÜÔºÅ', 'correct');
                rewardPokemon();
                setTimeout(generateQuestion, 2500);
            } else {
                showMessage(`‚ùå Á≠îÈåØ‰∫ÜÔºÅÊ≠£Á¢∫Á≠îÊ°àÊòØ ${currentQuestion.answer}`, 'incorrect');
                setTimeout(() => {
                    document.getElementById('message').style.display = 'none';
                    generateQuestion(); // Á≠îÈåØÂæåËá™ÂãïÊèõ‰∏ã‰∏ÄÈ°å
                }, 2000);
            }
            
            updateStats();
        }
        
        // È°ØÁ§∫Ë®äÊÅØ
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
        }
        
        // ÁçéÂãµÂØ∂ÂèØÂ§¢
        function rewardPokemon() {
            let randomType;
            
            // Á•ûË©±Á®ÆÁç≤ÂæóÊ¢ù‰ª∂ÔºöÁ≠îÂ∞ç10È°å‰∏îÊúâ5%Ê©üÁéáÔºåÊàñÁ≠îÂ∞ç50È°å‰∏îÊúâ15%Ê©üÁéá
            const canGetLegendary = (stats.correct >= 10 && Math.random() < 0.05) || 
                                   (stats.correct >= 50 && Math.random() < 0.15);
            
            if (canGetLegendary && collection.legendary.length < 5) {
                randomType = 'legendary';
            } else {
                // ÊôÆÈÄöÈ°ûÂûãÈö®Ê©üÈÅ∏Êìá
                const normalTypes = ['fire', 'water', 'grass', 'electric'];
                randomType = normalTypes[Math.floor(Math.random() * normalTypes.length)];
            }
            
            const typeData = pokemonTypes[randomType];
            
            // ÊâæÂà∞Ë©≤Â±¨ÊÄßÈÇÑÊ≤íÊî∂ÈõÜÁöÑÂØ∂ÂèØÂ§¢
            const availablePokemon = typeData.pokemon.filter(p => 
                !collection[randomType].some(collected => collected.id === p.id)
            );
            
            if (availablePokemon.length > 0) {
                const pokemon = availablePokemon[Math.floor(Math.random() * availablePokemon.length)];
                collection[randomType].push(pokemon);
                stats.pokemon++;
                
                showPokemon(pokemon, randomType);
                
                // Ê™¢Êü•ÊòØÂê¶ÂÆåÊàêË©≤Â±¨ÊÄßÊî∂ÈõÜÔºàÊî∂ÈõÜÂà∞5ÈöªÂç≥ÂèØÔºâ
                if (collection[randomType].length === 5) {
                    stats.stars++;
                    setTimeout(() => {
                        const starMessage = randomType === 'legendary' ? 
                            `üåü ÂÇ≥Ë™™ÔºÅÂÆåÊàêÁ•ûË©±Á®ÆÊî∂ÈõÜÔºÅÁç≤ÂæóÂÇ≥Ë™™‰πãÊòüÔºÅ` : 
                            `‚≠ê ÊÅ≠ÂñúÔºÅÂÆåÊàê${typeData.name}Êî∂ÈõÜÔºÅÁç≤Âæó‰∏ÄÈ°ÜÊòüÊòüÔºÅ`;
                        showMessage(starMessage, 'correct');
                    }, 1500);
                }
                
                renderCollection();
            }
        }
        
        // È°ØÁ§∫Áç≤ÂæóÁöÑÂØ∂ÂèØÂ§¢
        function showPokemon(pokemon, type) {
            const rewardEl = document.getElementById('pokemonReward');
            const typeData = pokemonTypes[type];
            
            rewardEl.innerHTML = `
                <div class="pokemon-card" id="newPokemon">
                    <img src="${getPokemonImageURL(pokemon.id)}" 
                         alt="${pokemon.nameCH}" 
                         class="pokemon-image" 
                         onerror="handleImageError(this, ${pokemon.id})">
                    <div class="pokemon-name">${pokemon.nameCH}</div>
                    <div class="pokemon-type" style="background-color: ${typeData.color}">
                        ${typeData.name}
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const card = document.getElementById('newPokemon');
                if (card) card.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                rewardEl.innerHTML = '';
            }, 3500);
        }
        
        // Êõ¥Êñ∞Áµ±Ë®à
        function updateStats() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('progressCount').textContent = usedQuestions.length;
            document.getElementById('pokemonCount').textContent = stats.pokemon;
            document.getElementById('starCount').textContent = stats.stars;
        }
        
        // Ê∏≤ÊüìÊî∂ÈõÜÈÄ≤Â∫¶
        function renderCollection() {
            const container = document.getElementById('typeCollections');
            container.innerHTML = '';
            
            Object.keys(pokemonTypes).forEach(typeKey => {
                const typeData = pokemonTypes[typeKey];
                const collected = collection[typeKey];
                const isComplete = collected.length >= 5;
                const isLegendary = typeKey === 'legendary';
                
                const div = document.createElement('div');
                div.className = `type-collection ${isComplete ? 'complete' : ''} ${isLegendary ? 'legendary' : ''}`;
                
                // È°ØÁ§∫ÊâÄÊúâÂØ∂ÂèØÂ§¢ÔºåÂ∑≤Êî∂ÈõÜÁöÑ‰∏çÁÅ∞Âåñ
                const pokemonHtml = typeData.pokemon.map(pokemon => {
                    const isCollected = collected.some(c => c.id === pokemon.id);
                    const paddedId = String(pokemon.id).padStart(3, '0');
                    return `<img src="https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/${paddedId}.png" 
                                 alt="${pokemon.nameCH}" 
                                 class="pokemon-mini ${isCollected ? 'collected' : ''}" 
                                 title="${pokemon.nameCH}"
                                 onerror="handleImageError(this, ${pokemon.id})">`;
                }).join('');
                
                const completeText = isComplete ? 
                    (isLegendary ? '<div style="margin-top: 8px; font-size: 1rem; font-weight: bold;">üåü ÂÇ≥Ë™™ÂÆåÊàêÔºÅ</div>' : 
                                  '<div style="margin-top: 8px; font-size: 1rem; font-weight: bold;">‚≠ê ÂÆåÊàêÔºÅ</div>') : '';
                
                div.innerHTML = `
                    <div class="type-header" style="color: ${isLegendary ? 'white' : typeData.color}">
                        ${typeData.name} (${collected.length}/5)
                    </div>
                    <div class="pokemon-grid">${pokemonHtml}</div>
                    ${completeText}
                `;
                
                container.appendChild(div);
            });
            
            // Ê∏≤ÊüìÊòüÊòü
            const starsEl = document.getElementById('starsDisplay');
            starsEl.innerHTML = Array(stats.stars).fill(0).map(() => '<span class="star">‚≠ê</span>').join('');
        }
        
        // ÂïüÂãïÈÅäÊà≤
        initGame();
    </script>
</body>
</html>