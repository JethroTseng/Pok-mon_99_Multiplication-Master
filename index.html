<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢99ä¹˜æ³•è¡¨éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .game-container {
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
        }
        
        .title {
            color: #2d3436;
            font-size: 2.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .stat {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .main-area {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
            align-items: flex-start;
        }
        
        .left-section {
            flex: 1;
        }
        
        .right-section {
            flex: 0 0 320px;
            min-height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .question-box {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 40px 30px;
            border-radius: 25px;
            border: 4px solid #667eea;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }
        
        .question-text {
            font-size: 3.5rem;
            color: #2d3436;
            margin-bottom: 25px;
            font-weight: bold;
        }
        
        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .answer-input {
            font-size: 2.2rem;
            padding: 20px 25px;
            border: 4px solid #ddd;
            border-radius: 15px;
            width: 200px;
            text-align: center;
            font-weight: bold;
            background: white;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 20px 30px;
            font-size: 1.6rem;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
        }
        
        .message {
            font-size: 1.4rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            font-weight: bold;
            display: none;
        }
        
        .message.correct {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
        }
        
        .message.incorrect {
            background: linear-gradient(45deg, #ff7675, #fd79a8);
            color: white;
        }
        
        .pokemon-reward {
            width: 100%;
        }
        
        .pokemon-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            transform: scale(0);
            transition: transform 0.6s ease;
            width: 100%;
            max-width: 300px;
        }
        
        .pokemon-card.show {
            transform: scale(1);
            animation: bounceIn 0.8s ease;
        }
        
        @keyframes bounceIn {
            0%, 20%, 60%, 100% { transform: scale(1); }
            40% { transform: scale(1.15); }
            80% { transform: scale(1.05); }
        }
        
        .pokemon-image {
            width: 120px;
            height: 120px;
            margin-bottom: 10px;
            image-rendering: pixelated;
        }
        
        .pokemon-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .pokemon-type {
            padding: 8px 15px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .collection {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #ddd;
        }
        
        .collection-title {
            font-size: 1.4rem;
            color: #2d3436;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .type-collections {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .type-collection {
            background: white;
            border-radius: 12px;
            padding: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .type-collection.complete {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            border-color: #f39c12;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }
        
        .type-collection.legendary {
            background: linear-gradient(45deg, #4a4a80, #3d3d6b);
            border-color: #9b59b6;
            color: white;
        }
        
        .type-collection.legendary.complete {
            background: linear-gradient(45deg, #fd79a8, #fdcb6e, #4a4a80);
            border-color: #e84393;
            box-shadow: 0 0 25px rgba(232, 67, 147, 0.8);
            animation: legendaryGlow 2s infinite alternate;
        }
        
        @keyframes legendaryGlow {
            0% { box-shadow: 0 0 25px rgba(232, 67, 147, 0.8); }
            100% { box-shadow: 0 0 35px rgba(74, 74, 128, 0.8); }
        }
        
        .type-header {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
            justify-items: center;
        }
        
        .pokemon-mini {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            image-rendering: pixelated;
            filter: grayscale(100%) brightness(0.5);
            transition: all 0.3s ease;
        }
        
        .pokemon-mini.collected {
            filter: none;
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .stars {
            font-size: 1.8rem;
            margin-top: 15px;
        }
        
        .star {
            color: #f39c12;
            margin: 0 3px;
            animation: twinkle 1.5s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(10deg); }
        }
        
        @media (max-width: 768px) {
            .title { font-size: 1.8rem; }
            .main-area {
                flex-direction: column;
                gap: 20px;
            }
            .right-section {
                flex: none;
                min-height: auto;
            }
            .question-box { padding: 30px 20px; }
            .question-text { font-size: 2.5rem; }
            .answer-input { 
                width: 160px; 
                font-size: 1.8rem; 
            }
            .submit-btn {
                font-size: 1.4rem;
                padding: 18px 25px;
            }
            .input-area { 
                flex-direction: column; 
                gap: 15px;
            }
            .stats { 
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            .type-collections {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .question-text { font-size: 2rem; }
            .answer-input { 
                width: 140px; 
                font-size: 1.6rem; 
            }
            .submit-btn { font-size: 1.2rem; }
            .type-collections { 
                grid-template-columns: 1fr; 
            }
            .pokemon-grid {
                grid-template-columns: repeat(10, 1fr);
            }
            .pokemon-mini {
                width: 16px;
                height: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title">ğŸ® å¯¶å¯å¤¢ä¹˜æ³•å¤§å¸«</h1>
        
        <div class="stats">
            <div class="stat">ğŸ“Š ç­”å° <span id="correctCount">0</span> é¡Œ</div>
            <div class="stat">ğŸ“ é€²åº¦ <span id="progressCount">0</span>/81</div>
            <div class="stat">ğŸ¯ å¯¶å¯å¤¢ <span id="pokemonCount">0</span> éš»</div>
            <div class="stat">â­ æ˜Ÿæ˜Ÿ <span id="starCount">0</span> é¡†</div>
        </div>
        
        <div class="main-area">
            <div class="left-section">
                <div class="question-box">
                    <div class="question-text" id="questionText">2 Ã— 3 = ?</div>
                    <div class="input-area">
                        <input type="number" id="answerInput" class="answer-input" placeholder="?">
                        <button onclick="checkAnswer()" class="submit-btn">ç¢ºèª</button>
                    </div>
                </div>
                <div id="message" class="message"></div>
            </div>
            
            <div class="right-section">
                <div class="pokemon-reward" id="pokemonReward"></div>
            </div>
        </div>
        
        <div class="collection">
            <h3 class="collection-title">ğŸ“š å¯¶å¯å¤¢æ”¶é›†å†Š - æ¯ç³»åˆ—æ”¶é›†5éš»ç²å¾—æ˜Ÿæ˜Ÿ | ğŸŒŸ ç¥è©±ç¨®ç¨€æœ‰å‡ºç¾</h3>
            <div class="type-collections" id="typeCollections"></div>
            <div class="stars" id="starsDisplay"></div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹
        let stats = {
            correct: 0,
            pokemon: 0,
            stars: 0
        };
        
        let currentQuestion = {};
        
        // å‡å‹»é¡Œç›®æ±  - ç¢ºä¿æ¯å€‹é¡Œç›®éƒ½ç·´ç¿’åˆ°
        let questionPool = [];
        let usedQuestions = [];
        
        // å¯¶å¯å¤¢è³‡æ–™ - æ¯ç¨®å±¬æ€§20éš»ï¼Œæ”¶é›†ä»»æ„5éš»ç²å¾—æ˜Ÿæ˜Ÿ
        const pokemonTypes = {
            fire: {
                name: 'ç«ç³»',
                color: '#ff6b6b',
                pokemon: [
                    {id: 4, name: 'charmander', nameCH: 'å°ç«é¾'},
                    {id: 5, name: 'charmeleon', nameCH: 'ç«æé¾'},
                    {id: 6, name: 'charizard', nameCH: 'å™´ç«é¾'},
                    {id: 37, name: 'vulpix', nameCH: 'å…­å°¾'},
                    {id: 38, name: 'ninetales', nameCH: 'ä¹å°¾'},
                    {id: 58, name: 'growlithe', nameCH: 'å¡è’‚ç‹—'},
                    {id: 59, name: 'arcanine', nameCH: 'é¢¨é€Ÿç‹—'},
                    {id: 77, name: 'ponyta', nameCH: 'å°ç«é¦¬'},
                    {id: 78, name: 'rapidash', nameCH: 'çƒˆç„°é¦¬'},
                    {id: 126, name: 'magmar', nameCH: 'é´¨å˜´ç«ç¸'},
                    {id: 136, name: 'flareon', nameCH: 'ç«ä¼Šå¸ƒ'},
                    {id: 146, name: 'moltres', nameCH: 'ç«ç„°é³¥'},
                    {id: 155, name: 'cyndaquil', nameCH: 'ç«çƒé¼ '},
                    {id: 156, name: 'quilava', nameCH: 'ç«å²©é¼ '},
                    {id: 157, name: 'typhlosion', nameCH: 'ç«çˆ†ç¸'},
                    {id: 218, name: 'slugma', nameCH: 'ç†”å²©èŸ²'},
                    {id: 219, name: 'magcargo', nameCH: 'ç†”å²©è¸ç‰›'},
                    {id: 240, name: 'magby', nameCH: 'é´¨å˜´å¯¶å¯¶'},
                    {id: 244, name: 'entei', nameCH: 'ç‚å¸'},
                    {id: 250, name: 'ho-oh', nameCH: 'é³³ç‹'}
                ]
            },
            water: {
                name: 'æ°´ç³»', 
                color: '#74b9ff',
                pokemon: [
                    {id: 7, name: 'squirtle', nameCH: 'å‚‘å°¼é¾œ'},
                    {id: 8, name: 'wartortle', nameCH: 'å¡å’ªé¾œ'},
                    {id: 9, name: 'blastoise', nameCH: 'æ°´ç®­é¾œ'},
                    {id: 54, name: 'psyduck', nameCH: 'å¯é”é´¨'},
                    {id: 55, name: 'golduck', nameCH: 'å“¥é”é´¨'},
                    {id: 72, name: 'tentacool', nameCH: 'ç‘ªç‘™æ°´æ¯'},
                    {id: 73, name: 'tentacruel', nameCH: 'æ¯’åˆºæ°´æ¯'},
                    {id: 79, name: 'slowpoke', nameCH: 'å‘†å‘†ç¸'},
                    {id: 80, name: 'slowbro', nameCH: 'å‘†æ®¼ç¸'},
                    {id: 90, name: 'shellder', nameCH: 'å¤§èˆŒè²'},
                    {id: 91, name: 'cloyster', nameCH: 'åˆºç”²è²'},
                    {id: 98, name: 'krabby', nameCH: 'å¤§é‰—èŸ¹'},
                    {id: 99, name: 'kingler', nameCH: 'å·¨é‰—èŸ¹'},
                    {id: 116, name: 'horsea', nameCH: 'å¢¨æµ·é¦¬'},
                    {id: 117, name: 'seadra', nameCH: 'æµ·åˆºé¾'},
                    {id: 118, name: 'goldeen', nameCH: 'è§’é‡‘é­š'},
                    {id: 119, name: 'seaking', nameCH: 'é‡‘é­šç‹'},
                    {id: 120, name: 'staryu', nameCH: 'æµ·æ˜Ÿæ˜Ÿ'},
                    {id: 121, name: 'starmie', nameCH: 'å¯¶çŸ³æµ·æ˜Ÿ'},
                    {id: 129, name: 'magikarp', nameCH: 'é¯‰é­šç‹'}
                ]
            },
            grass: {
                name: 'è‰ç³»',
                color: '#55a3ff', 
                pokemon: [
                    {id: 1, name: 'bulbasaur', nameCH: 'å¦™è›™ç¨®å­'},
                    {id: 2, name: 'ivysaur', nameCH: 'å¦™è›™è‰'},
                    {id: 3, name: 'venusaur', nameCH: 'å¦™è›™èŠ±'},
                    {id: 43, name: 'oddish', nameCH: 'èµ°è·¯è‰'},
                    {id: 44, name: 'gloom', nameCH: 'è‡­è‡­èŠ±'},
                    {id: 45, name: 'vileplume', nameCH: 'éœ¸ç‹èŠ±'},
                    {id: 46, name: 'paras', nameCH: 'æ´¾æ‹‰æ–¯'},
                    {id: 47, name: 'parasect', nameCH: 'æ´¾æ‹‰æ–¯ç‰¹'},
                    {id: 69, name: 'bellsprout', nameCH: 'å–‡å­èŠ½'},
                    {id: 70, name: 'weepinbell', nameCH: 'å£å‘†èŠ±'},
                    {id: 71, name: 'victreebel', nameCH: 'å¤§é£ŸèŠ±'},
                    {id: 102, name: 'exeggcute', nameCH: 'è›‹è›‹'},
                    {id: 103, name: 'exeggutor', nameCH: 'æ¤°è›‹æ¨¹'},
                    {id: 114, name: 'tangela', nameCH: 'è”“è—¤æ€ª'},
                    {id: 152, name: 'chikorita', nameCH: 'èŠè‰è‘‰'},
                    {id: 153, name: 'bayleef', nameCH: 'æœˆæ¡‚è‘‰'},
                    {id: 154, name: 'meganium', nameCH: 'å¤§ç«ºè‘µ'},
                    {id: 182, name: 'bellossom', nameCH: 'ç¾éº—èŠ±'},
                    {id: 187, name: 'hoppip', nameCH: 'æ¯½å­è‰'},
                    {id: 191, name: 'sunkern', nameCH: 'å‘æ—¥ç¨®å­'}
                ]
            },
            electric: {
                name: 'é›»ç³»',
                color: '#feca57',
                pokemon: [
                    {id: 25, name: 'pikachu', nameCH: 'çš®å¡ä¸˜'},
                    {id: 26, name: 'raichu', nameCH: 'é›·ä¸˜'},
                    {id: 81, name: 'magnemite', nameCH: 'å°ç£æ€ª'},
                    {id: 82, name: 'magneton', nameCH: 'ä¸‰åˆä¸€ç£æ€ª'},
                    {id: 100, name: 'voltorb', nameCH: 'é›·é›»çƒ'},
                    {id: 101, name: 'electrode', nameCH: 'é ‘çš®é›·å½ˆ'},
                    {id: 125, name: 'electabuzz', nameCH: 'é›»æ“Šç¸'},
                    {id: 135, name: 'jolteon', nameCH: 'é›·ä¼Šå¸ƒ'},
                    {id: 145, name: 'zapdos', nameCH: 'é–ƒé›»é³¥'},
                    {id: 172, name: 'pichu', nameCH: 'çš®ä¸˜'},
                    {id: 179, name: 'mareep', nameCH: 'å’©åˆ©ç¾Š'},
                    {id: 180, name: 'flaaffy', nameCH: 'èŒ¸èŒ¸ç¾Š'},
                    {id: 181, name: 'ampharos', nameCH: 'é›»é¾'},
                    {id: 239, name: 'elekid', nameCH: 'é›»æ“Šæ€ª'},
                    {id: 243, name: 'raikou', nameCH: 'é›·å…¬'},
                    {id: 309, name: 'electrike', nameCH: 'è½é›·ç¸'},
                    {id: 310, name: 'manectric', nameCH: 'é›·é›»ç¸'},
                    {id: 311, name: 'plusle', nameCH: 'æ­£é›»æ‹æ‹'},
                    {id: 312, name: 'minun', nameCH: 'è² é›»æ‹æ‹'},
                    {id: 466, name: 'electivire', nameCH: 'é›»æ“Šé­”ç¸'}
                ]
            },
            legendary: {
                name: 'ç¥è©±ç¨®',
                color: '#9b59b6',
                pokemon: [
                    {id: 144, name: 'articuno', nameCH: 'æ€¥å‡é³¥'},
                    {id: 145, name: 'zapdos', nameCH: 'é–ƒé›»é³¥'},
                    {id: 146, name: 'moltres', nameCH: 'ç«ç„°é³¥'},
                    {id: 150, name: 'mewtwo', nameCH: 'è¶…å¤¢'},
                    {id: 151, name: 'mew', nameCH: 'å¤¢å¹»'},
                    {id: 243, name: 'raikou', nameCH: 'é›·å…¬'},
                    {id: 244, name: 'entei', nameCH: 'ç‚å¸'},
                    {id: 245, name: 'suicune', nameCH: 'æ°´å›'},
                    {id: 249, name: 'lugia', nameCH: 'æ´›å¥‡äº'},
                    {id: 250, name: 'ho-oh', nameCH: 'é³³ç‹'},
                    {id: 251, name: 'celebi', nameCH: 'æ™‚æ‹‰æ¯”'},
                    {id: 380, name: 'latias', nameCH: 'æ‹‰å¸äºæ–¯'},
                    {id: 381, name: 'latios', nameCH: 'æ‹‰å¸æ­æ–¯'},
                    {id: 382, name: 'kyogre', nameCH: 'è“‹æ­å¡'},
                    {id: 383, name: 'groudon', nameCH: 'å›ºæ‹‰å¤š'},
                    {id: 384, name: 'rayquaza', nameCH: 'çƒˆç©ºå'},
                    {id: 385, name: 'jirachi', nameCH: 'åŸºæ‹‰ç¥ˆ'},
                    {id: 386, name: 'deoxys', nameCH: 'ä»£æ­å¥‡å¸Œæ–¯'},
                    {id: 483, name: 'dialga', nameCH: 'å¸ç‰™ç›§å¡'},
                    {id: 484, name: 'palkia', nameCH: 'å¸•è·¯å¥‡äº'}
                ]
            }
        };
        
        // æ”¶é›†é€²åº¦
        let collection = {
            fire: [],
            water: [], 
            grass: [],
            electric: [],
            legendary: []
        };
        
        // ç²å–å¯¶å¯å¤¢åœ–ç‰‡URL - ä½¿ç”¨å¤šé‡å‚™æ¡ˆ
        function getPokemonImageURL(id, isOfficial = true) {
            const paddedId = String(id).padStart(3, '0');
            if (isOfficial) {
                return `https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/${paddedId}.png`;
            }
            return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
        }
        
        // è™•ç†åœ–ç‰‡è¼‰å…¥éŒ¯èª¤çš„å‡½æ•¸
        function handleImageError(img, id) {
            if (img.src.includes('HybridShivam')) {
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
            } else if (img.src.includes('sprites/pokemon')) {
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${id}.png`;
            } else {
                img.style.display = 'none';
                img.parentElement.innerHTML += '<div style="font-size: 1rem;">â“</div>';
            }
        }
        
        // åˆå§‹åŒ–é¡Œç›®æ± 
        function initQuestionPool() {
            questionPool = [];
            for (let i = 1; i <= 9; i++) {
                for (let j = 1; j <= 9; j++) {
                    questionPool.push({
                        num1: i,
                        num2: j,
                        answer: i * j
                    });
                }
            }
            // æ‰“äº‚é¡Œç›®é †åº
            shuffleArray(questionPool);
        }
        
        // æ‰“äº‚é™£åˆ—é †åº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // åˆå§‹åŒ–éŠæˆ²
        function initGame() {
            initQuestionPool();
            generateQuestion();
            updateStats();
            renderCollection();
            
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        }
        
        // ç”Ÿæˆå•é¡Œ - å‡å‹»æ¨¡å¼
        function generateQuestion() {
            // å¦‚æœé¡Œç›®æ± ç”¨å®Œäº†ï¼Œé‡æ–°åˆå§‹åŒ–
            if (questionPool.length === 0) {
                initQuestionPool();
                usedQuestions = [];
                showMessage('ğŸ‰ æ­å–œï¼å®Œæˆä¸€è¼ª99ä¹˜æ³•è¡¨ç·´ç¿’ï¼é–‹å§‹æ–°ä¸€è¼ªï¼', 'correct');
                setTimeout(() => {
                    document.getElementById('message').style.display = 'none';
                }, 3000);
            }
            
            // å¾é¡Œç›®æ± ä¸­å–å‡ºä¸€å€‹é¡Œç›®
            const questionIndex = Math.floor(Math.random() * questionPool.length);
            currentQuestion = questionPool[questionIndex];
            
            // å°‡é¡Œç›®å¾æ± ä¸­ç§»é™¤ï¼ŒåŠ å…¥å·²ç”¨é¡Œç›®
            questionPool.splice(questionIndex, 1);
            usedQuestions.push(currentQuestion);
            
            document.getElementById('questionText').textContent = `${currentQuestion.num1} Ã— ${currentQuestion.num2} = ?`;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
        }
        
        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = parseInt(document.getElementById('answerInput').value);
            
            if (isNaN(userAnswer)) {
                showMessage('è«‹è¼¸å…¥æ•¸å­—ï¼', 'incorrect');
                return;
            }
            
            if (userAnswer === currentQuestion.answer) {
                stats.correct++;
                showMessage('ğŸ‰ ç­”å°äº†ï¼å¤ªæ£’äº†ï¼', 'correct');
                rewardPokemon();
                setTimeout(generateQuestion, 2500);
            } else {
                showMessage(`âŒ ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ ${currentQuestion.answer}`, 'incorrect');
                setTimeout(() => {
                    document.getElementById('message').style.display = 'none';
                    generateQuestion(); // ç­”éŒ¯å¾Œè‡ªå‹•æ›ä¸‹ä¸€é¡Œ
                }, 2000);
            }
            
            updateStats();
        }
        
        // é¡¯ç¤ºè¨Šæ¯
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
        }
        
        // çå‹µå¯¶å¯å¤¢
        function rewardPokemon() {
            let randomType;
            
            // ç¥è©±ç¨®ç²å¾—æ¢ä»¶ï¼šç­”å°10é¡Œä¸”æœ‰5%æ©Ÿç‡ï¼Œæˆ–ç­”å°50é¡Œä¸”æœ‰15%æ©Ÿç‡
            const canGetLegendary = (stats.correct >= 10 && Math.random() < 0.05) || 
                                   (stats.correct >= 50 && Math.random() < 0.15);
            
            if (canGetLegendary && collection.legendary.length < 5) {
                randomType = 'legendary';
            } else {
                // æ™®é€šé¡å‹éš¨æ©Ÿé¸æ“‡
                const normalTypes = ['fire', 'water', 'grass', 'electric'];
                randomType = normalTypes[Math.floor(Math.random() * normalTypes.length)];
            }
            
            const typeData = pokemonTypes[randomType];
            
            // æ‰¾åˆ°è©²å±¬æ€§é‚„æ²’æ”¶é›†çš„å¯¶å¯å¤¢
            const availablePokemon = typeData.pokemon.filter(p => 
                !collection[randomType].some(collected => collected.id === p.id)
            );
            
            if (availablePokemon.length > 0) {
                const pokemon = availablePokemon[Math.floor(Math.random() * availablePokemon.length)];
                collection[randomType].push(pokemon);
                stats.pokemon++;
                
                showPokemon(pokemon, randomType);
                
                // æª¢æŸ¥æ˜¯å¦å®Œæˆè©²å±¬æ€§æ”¶é›†ï¼ˆæ”¶é›†åˆ°5éš»å³å¯ï¼‰
                if (collection[randomType].length === 5) {
                    stats.stars++;
                    setTimeout(() => {
                        const starMessage = randomType === 'legendary' ? 
                            `ğŸŒŸ å‚³èªªï¼å®Œæˆç¥è©±ç¨®æ”¶é›†ï¼ç²å¾—å‚³èªªä¹‹æ˜Ÿï¼` : 
                            `â­ æ­å–œï¼å®Œæˆ${typeData.name}æ”¶é›†ï¼ç²å¾—ä¸€é¡†æ˜Ÿæ˜Ÿï¼`;
                        showMessage(starMessage, 'correct');
                    }, 1500);
                }
                
                renderCollection();
            }
        }
        
        // é¡¯ç¤ºç²å¾—çš„å¯¶å¯å¤¢
        function showPokemon(pokemon, type) {
            const rewardEl = document.getElementById('pokemonReward');
            const typeData = pokemonTypes[type];
            
            rewardEl.innerHTML = `
                <div class="pokemon-card" id="newPokemon">
                    <img src="${getPokemonImageURL(pokemon.id)}" 
                         alt="${pokemon.nameCH}" 
                         class="pokemon-image" 
                         onerror="handleImageError(this, ${pokemon.id})">
                    <div class="pokemon-name">${pokemon.nameCH}</div>
                    <div class="pokemon-type" style="background-color: ${typeData.color}">
                        ${typeData.name}
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const card = document.getElementById('newPokemon');
                if (card) card.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                rewardEl.innerHTML = '';
            }, 3500);
        }
        
        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('progressCount').textContent = usedQuestions.length;
            document.getElementById('pokemonCount').textContent = stats.pokemon;
            document.getElementById('starCount').textContent = stats.stars;
        }
        
        // æ¸²æŸ“æ”¶é›†é€²åº¦
        function renderCollection() {
            const container = document.getElementById('typeCollections');
            container.innerHTML = '';
            
            Object.keys(pokemonTypes).forEach(typeKey => {
                const typeData = pokemonTypes[typeKey];
                const collected = collection[typeKey];
                const isComplete = collected.length >= 5;
                const isLegendary = typeKey === 'legendary';
                
                const div = document.createElement('div');
                div.className = `type-collection ${isComplete ? 'complete' : ''} ${isLegendary ? 'legendary' : ''}`;
                
                // é¡¯ç¤ºæ‰€æœ‰å¯¶å¯å¤¢ï¼Œå·²æ”¶é›†çš„ä¸ç°åŒ–
                const pokemonHtml = typeData.pokemon.map(pokemon => {
                    const isCollected = collected.some(c => c.id === pokemon.id);
                    const paddedId = String(pokemon.id).padStart(3, '0');
                    return `<img src="https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/${paddedId}.png" 
                                 alt="${pokemon.nameCH}" 
                                 class="pokemon-mini ${isCollected ? 'collected' : ''}" 
                                 title="${pokemon.nameCH}"
                                 onerror="handleImageError(this, ${pokemon.id})">`;
                }).join('');
                
                const completeText = isComplete ? 
                    (isLegendary ? '<div style="margin-top: 8px; font-size: 1rem; font-weight: bold;">ğŸŒŸ å‚³èªªå®Œæˆï¼</div>' : 
                                  '<div style="margin-top: 8px; font-size: 1rem; font-weight: bold;">â­ å®Œæˆï¼</div>') : '';
                
                div.innerHTML = `
                    <div class="type-header" style="color: ${isLegendary ? 'white' : typeData.color}">
                        ${typeData.name} (${collected.length}/5)
                    </div>
                    <div class="pokemon-grid">${pokemonHtml}</div>
                    ${completeText}
                `;
                
                container.appendChild(div);
            });
            
            // æ¸²æŸ“æ˜Ÿæ˜Ÿ
            const starsEl = document.getElementById('starsDisplay');
            starsEl.innerHTML = Array(stats.stars).fill(0).map(() => '<span class="star">â­</span>').join('');
        }
        
        // å•Ÿå‹•éŠæˆ²
        initGame();
    </script>
</body>
</html>