<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寶可夢99乘法表遊戲</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .game-container {
            background: white;
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            position: relative;
        }
        
        .language-switch {
            position: absolute;
            top: 20px;
            right: 25px;
        }
        
        .lang-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }
        
        .lang-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .title {
            color: #2d3436;
            font-size: 2.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 25px;
        }
        
        .stat {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .main-area {
            display: flex;
            gap: 25px;
            margin-bottom: 25px;
            align-items: flex-start;
        }
        
        .left-section {
            flex: 1;
        }
        
        .right-section {
            flex: 0 0 320px;
            min-height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .question-box {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 40px 30px;
            border-radius: 25px;
            border: 4px solid #667eea;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }
        
        .question-text {
            font-size: 3.5rem;
            color: #2d3436;
            margin-bottom: 25px;
            font-weight: bold;
        }
        
        .input-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        .answer-input {
            font-size: 2.2rem;
            padding: 20px 25px;
            border: 4px solid #ddd;
            border-radius: 15px;
            width: 200px;
            text-align: center;
            font-weight: bold;
            background: white;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 20px 30px;
            font-size: 1.6rem;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.4);
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
        }
        
        .message {
            font-size: 1.4rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            font-weight: bold;
            display: none;
        }
        
        .message.correct {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
        }
        
        .message.incorrect {
            background: linear-gradient(45deg, #ff7675, #fd79a8);
            color: white;
        }
        
        .pokemon-reward {
            width: 100%;
            position: relative;
        }
        
        .pokemon-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            transform: scale(0);
            transition: transform 0.6s ease;
            width: 100%;
            max-width: 300px;
        }
        
        .pokemon-card.show {
            transform: scale(1);
            animation: bounceIn 0.8s ease;
        }
        
        .pokemon-card.legendary {
            background: linear-gradient(45deg, #fff, #f8f4ff, #fff);
            border: 3px solid #9b59b6;
            box-shadow: 0 0 30px rgba(155, 89, 182, 0.8);
        }
        
        .pokemon-card.legendary.show {
            transform: scale(1);
            animation: legendaryBounceIn 1.2s ease;
        }
        
        @keyframes legendaryBounceIn {
            0% { 
                transform: scale(0) rotate(0deg); 
                opacity: 0;
                box-shadow: 0 0 0 rgba(155, 89, 182, 0);
            }
            20% { 
                transform: scale(0.3) rotate(10deg); 
                opacity: 0.3;
                box-shadow: 0 0 15px rgba(155, 89, 182, 0.5);
            }
            60% { 
                transform: scale(1.2) rotate(-5deg); 
                opacity: 0.8;
                box-shadow: 0 0 40px rgba(155, 89, 182, 1);
            }
            80% { 
                transform: scale(0.95) rotate(2deg); 
                opacity: 1;
                box-shadow: 0 0 35px rgba(155, 89, 182, 0.9);
            }
            100% { 
                transform: scale(1) rotate(0deg); 
                opacity: 1;
                box-shadow: 0 0 30px rgba(155, 89, 182, 0.8);
            }
        }
        
        @keyframes bounceIn {
            0%, 20%, 60%, 100% { transform: scale(1); }
            40% { transform: scale(1.15); }
            80% { transform: scale(1.05); }
        }
        
        .pokemon-image {
            width: 120px;
            height: 120px;
            margin-bottom: 10px;
            image-rendering: pixelated;
        }
        
        .pokemon-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .pokemon-type {
            padding: 8px 15px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .collection {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid #ddd;
        }
        
        .collection-title {
            font-size: 1.4rem;
            color: #2d3436;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .type-collections {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .type-collection {
            background: white;
            border-radius: 12px;
            padding: 8px;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }
        
        .type-collection.complete {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            border-color: #f39c12;
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);
        }
        
        .type-collection.legendary {
            background: linear-gradient(45deg, #e6e6f2, #d4d4e8);
            border-color: #9b59b6;
            color: #4a4a80;
        }
        
        .type-collection.legendary.complete {
            background: linear-gradient(45deg, #fd79a8, #fdcb6e, #e6e6f2);
            border-color: #e84393;
            box-shadow: 0 0 25px rgba(232, 67, 147, 0.8);
            animation: legendaryGlow 2s infinite alternate;
        }
        
        @keyframes legendaryGlow {
            0% { box-shadow: 0 0 25px rgba(232, 67, 147, 0.8); }
            100% { box-shadow: 0 0 35px rgba(230, 230, 242, 0.8); }
        }
        
        .type-header {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .pokemon-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
            justify-items: center;
        }
        
        .pokemon-mini {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            image-rendering: pixelated;
            filter: grayscale(100%) brightness(0.5);
            transition: all 0.3s ease;
        }
        
        .pokemon-mini.collected {
            filter: none;
            animation: pulse 0.5s ease;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .stars {
            font-size: 1.8rem;
            margin-top: 15px;
        }
        
        .star {
            color: #f39c12;
            margin: 0 3px;
            animation: twinkle 1.5s infinite alternate;
        }
        
        @keyframes twinkle {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(10deg); }
        }
        
        .legendary-stars {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .legendary-star {
            position: absolute;
            color: #ffd700;
            font-size: 20px;
            animation: sparkle 1.5s ease-in-out infinite;
        }
        
        .legendary-star:nth-child(odd) {
            animation-delay: 0.3s;
            color: #ff69b4;
        }
        
        .legendary-star:nth-child(3n) {
            animation-delay: 0.6s;
            color: #9b59b6;
        }
        
        @keyframes sparkle {
            0% { 
                opacity: 0; 
                transform: translateY(20px) scale(0) rotate(0deg); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(-10px) scale(1.2) rotate(180deg); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-40px) scale(0) rotate(360deg); 
            }
        }
        
        @media (max-width: 768px) {
            .title { font-size: 1.8rem; }
            .main-area {
                flex-direction: column;
                gap: 20px;
            }
            .right-section {
                flex: none;
                min-height: auto;
            }
            .question-box { padding: 30px 20px; }
            .question-text { font-size: 2.5rem; }
            .answer-input { 
                width: 160px; 
                font-size: 1.8rem; 
            }
            .submit-btn {
                font-size: 1.4rem;
                padding: 18px 25px;
            }
            .input-area { 
                flex-direction: column; 
                gap: 15px;
            }
            .stats { 
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            .type-collections {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .question-text { font-size: 2rem; }
            .answer-input { 
                width: 140px; 
                font-size: 1.6rem; 
            }
            .submit-btn { font-size: 1.2rem; }
            .type-collections { 
                grid-template-columns: 1fr; 
            }
            .pokemon-grid {
                grid-template-columns: repeat(10, 1fr);
            }
            .pokemon-mini {
                width: 16px;
                height: 16px;
            }
        }
    </style>
</head>
<body>
        <div class="game-container">
            <div class="language-switch">
                <button id="langBtn" onclick="toggleLanguage()" class="lang-btn">🌐 EN</button>
            </div>
            <h1 class="title" data-zh="🎮 寶可夢乘法大師" data-en="🎮 Pokémon Math Master">🎮 寶可夢乘法大師</h1>        <div class="stats">
            <div class="stat"><span data-zh="📊 答對" data-en="📊 Correct">📊 答對</span> <span id="correctCount">0</span> <span data-zh="題" data-en="questions">題</span></div>
            <div class="stat"><span data-zh="📝 進度" data-en="📝 Progress">📝 進度</span> <span id="progressCount">0</span>/81</div>
            <div class="stat"><span data-zh="🎯 寶可夢" data-en="🎯 Pokémon">🎯 寶可夢</span> <span id="pokemonCount">0</span> <span data-zh="隻" data-en="caught">隻</span></div>
            <div class="stat"><span data-zh="⭐ 星星" data-en="⭐ Stars">⭐ 星星</span> <span id="starCount">0</span> <span data-zh="顆" data-en="earned">顆</span></div>
        </div>
        
        <div class="main-area">
            <div class="left-section">
                <div class="question-box">
                    <div class="question-text" id="questionText">2 × 3 = ?</div>
                    <div class="input-area">
                        <input type="number" id="answerInput" class="answer-input" data-zh-placeholder="?" data-en-placeholder="?" placeholder="?">
                        <button onclick="checkAnswer()" class="submit-btn" data-zh="確認" data-en="Submit">確認</button>
                    </div>
                </div>
                <div id="message" class="message"></div>
            </div>
            
            <div class="right-section">
                <div class="pokemon-reward" id="pokemonReward"></div>
            </div>
        </div>
        
        <div class="collection">
            <h3 class="collection-title" data-zh="📚 寶可夢收集冊 - 每收集5隻獲得1顆星星，可持續收集獲得更多星星！ | 🌟 神話種稀有出現" data-en="📚 Pokémon Collection - Earn 1 star for every 5 caught, keep collecting for more stars! | 🌟 Legendary rare encounters">📚 寶可夢收集冊 - 每收集5隻獲得1顆星星，可持續收集獲得更多星星！ | 🌟 神話種稀有出現</h3>
            <div class="type-collections" id="typeCollections"></div>
            <div class="stars" id="starsDisplay"></div>
        </div>
    </div>

    <script>
        // 遊戲狀態
        let stats = {
            correct: 0,
            pokemon: 0,
            stars: 0
        };
        
        let currentQuestion = {};
        
        // 均勻題目池 - 確保每個題目都練習到
        let questionPool = [];
        let usedQuestions = [];
        
        // 神話種冷卻機制
        let lastLegendaryCount = -1;
        
        // 語言設定
        let currentLanguage = 'en';
        
        // 翻譯資料
        const translations = {
            messages: {
                zh: {
                    inputNumber: '請輸入數字！',
                    correct: '🎉 答對了！太棒了！',
                    incorrect: '❌ 答錯了！正確答案是',
                    roundComplete: '🎉 恭喜！完成一輪99乘法表練習！開始新一輪！',
                    legendary: '🌟 傳說降臨！獲得神話種寶可夢！',
                    starEarned: '⭐ 恭喜！完成{type}第{stage}階段收集！獲得一顆星星！',
                    legendaryStarEarned: '🌟 傳說！完成神話種第{stage}階段收集！獲得傳說之星！',
                    starsEarned: '⭐ 已獲得 {count} 顆星星',
                    legendaryStarsEarned: '🌟 已獲得 {count} 顆星星'
                },
                en: {
                    inputNumber: 'Please enter a number!',
                    correct: '🎉 Correct! Excellent!',
                    incorrect: '❌ Wrong! The correct answer is',
                    roundComplete: '🎉 Congratulations! Completed one round of 99 multiplication tables! Starting new round!',
                    legendary: '🌟 Legend appears! Got a legendary Pokémon!',
                    starEarned: '⭐ Congratulations! Completed {type} stage {stage}! Earned a star!',
                    legendaryStarEarned: '🌟 Legend! Completed Legendary stage {stage}! Earned a legendary star!',
                    starsEarned: '⭐ Earned {count} stars',
                    legendaryStarsEarned: '🌟 Earned {count} stars'
                }
            },
            types: {
                zh: {
                    fire: '火系',
                    water: '水系',
                    grass: '草系',
                    electric: '電系',
                    legendary: '神話種'
                },
                en: {
                    fire: 'Fire',
                    water: 'Water', 
                    grass: 'Grass',
                    electric: 'Electric',
                    legendary: 'Legendary'
                }
            }
        };
        
        // 寶可夢資料 - 每種屬性20隻，收集任意5隻獲得星星
        const pokemonTypes = {
            fire: {
                name: '火系',
                color: '#ff6b6b',
                pokemon: [
                    {id: 4, name: 'charmander', nameCH: '小火龍', nameEN: 'Charmander'},
                    {id: 5, name: 'charmeleon', nameCH: '火恐龍', nameEN: 'Charmeleon'},
                    {id: 6, name: 'charizard', nameCH: '噴火龍', nameEN: 'Charizard'},
                    {id: 37, name: 'vulpix', nameCH: '六尾', nameEN: 'Vulpix'},
                    {id: 38, name: 'ninetales', nameCH: '九尾', nameEN: 'Ninetales'},
                    {id: 58, name: 'growlithe', nameCH: '卡蒂狗', nameEN: 'Growlithe'},
                    {id: 59, name: 'arcanine', nameCH: '風速狗', nameEN: 'Arcanine'},
                    {id: 77, name: 'ponyta', nameCH: '小火馬', nameEN: 'Ponyta'},
                    {id: 78, name: 'rapidash', nameCH: '烈焰馬', nameEN: 'Rapidash'},
                    {id: 126, name: 'magmar', nameCH: '鴨嘴火獸', nameEN: 'Magmar'},
                    {id: 136, name: 'flareon', nameCH: '火伊布', nameEN: 'Flareon'},
                    {id: 146, name: 'moltres', nameCH: '火焰鳥', nameEN: 'Moltres'},
                    {id: 155, name: 'cyndaquil', nameCH: '火球鼠', nameEN: 'Cyndaquil'},
                    {id: 156, name: 'quilava', nameCH: '火岩鼠', nameEN: 'Quilava'},
                    {id: 157, name: 'typhlosion', nameCH: '火爆獸', nameEN: 'Typhlosion'},
                    {id: 218, name: 'slugma', nameCH: '熔岩蟲', nameEN: 'Slugma'},
                    {id: 219, name: 'magcargo', nameCH: '熔岩蝸牛', nameEN: 'Magcargo'},
                    {id: 240, name: 'magby', nameCH: '鴨嘴寶寶', nameEN: 'Magby'},
                    {id: 244, name: 'entei', nameCH: '炎帝', nameEN: 'Entei'},
                    {id: 250, name: 'ho-oh', nameCH: '鳳王', nameEN: 'Ho-Oh'}
                ]
            },
            water: {
                name: '水系', 
                color: '#74b9ff',
                pokemon: [
                    {id: 7, name: 'squirtle', nameCH: '傑尼龜', nameEN: 'Squirtle'},
                    {id: 8, name: 'wartortle', nameCH: '卡咪龜', nameEN: 'Wartortle'},
                    {id: 9, name: 'blastoise', nameCH: '水箭龜', nameEN: 'Blastoise'},
                    {id: 54, name: 'psyduck', nameCH: '可達鴨', nameEN: 'Psyduck'},
                    {id: 55, name: 'golduck', nameCH: '哥達鴨', nameEN: 'Golduck'},
                    {id: 72, name: 'tentacool', nameCH: '瑪瑙水母', nameEN: 'Tentacool'},
                    {id: 73, name: 'tentacruel', nameCH: '毒刺水母', nameEN: 'Tentacruel'},
                    {id: 79, name: 'slowpoke', nameCH: '呆呆獸', nameEN: 'Slowpoke'},
                    {id: 80, name: 'slowbro', nameCH: '呆殼獸', nameEN: 'Slowbro'},
                    {id: 90, name: 'shellder', nameCH: '大舌貝', nameEN: 'Shellder'},
                    {id: 91, name: 'cloyster', nameCH: '刺甲貝', nameEN: 'Cloyster'},
                    {id: 98, name: 'krabby', nameCH: '大鉗蟹', nameEN: 'Krabby'},
                    {id: 99, name: 'kingler', nameCH: '巨鉗蟹', nameEN: 'Kingler'},
                    {id: 116, name: 'horsea', nameCH: '墨海馬', nameEN: 'Horsea'},
                    {id: 117, name: 'seadra', nameCH: '海刺龍', nameEN: 'Seadra'},
                    {id: 118, name: 'goldeen', nameCH: '角金魚', nameEN: 'Goldeen'},
                    {id: 119, name: 'seaking', nameCH: '金魚王', nameEN: 'Seaking'},
                    {id: 120, name: 'staryu', nameCH: '海星星', nameEN: 'Staryu'},
                    {id: 121, name: 'starmie', nameCH: '寶石海星', nameEN: 'Starmie'},
                    {id: 129, name: 'magikarp', nameCH: '鯉魚王', nameEN: 'Magikarp'}
                ]
            },
            grass: {
                name: '草系',
                color: '#55a3ff', 
                pokemon: [
                    {id: 1, name: 'bulbasaur', nameCH: '妙蛙種子', nameEN: 'Bulbasaur'},
                    {id: 2, name: 'ivysaur', nameCH: '妙蛙草', nameEN: 'Ivysaur'},
                    {id: 3, name: 'venusaur', nameCH: '妙蛙花', nameEN: 'Venusaur'},
                    {id: 43, name: 'oddish', nameCH: '走路草', nameEN: 'Oddish'},
                    {id: 44, name: 'gloom', nameCH: '臭臭花', nameEN: 'Gloom'},
                    {id: 45, name: 'vileplume', nameCH: '霸王花', nameEN: 'Vileplume'},
                    {id: 46, name: 'paras', nameCH: '派拉斯', nameEN: 'Paras'},
                    {id: 47, name: 'parasect', nameCH: '派拉斯特', nameEN: 'Parasect'},
                    {id: 69, name: 'bellsprout', nameCH: '喇叭芽', nameEN: 'Bellsprout'},
                    {id: 70, name: 'weepinbell', nameCH: '口呆花', nameEN: 'Weepinbell'},
                    {id: 71, name: 'victreebel', nameCH: '大食花', nameEN: 'Victreebel'},
                    {id: 102, name: 'exeggcute', nameCH: '蛋蛋', nameEN: 'Exeggcute'},
                    {id: 103, name: 'exeggutor', nameCH: '椰蛋樹', nameEN: 'Exeggutor'},
                    {id: 114, name: 'tangela', nameCH: '蔓藤怪', nameEN: 'Tangela'},
                    {id: 152, name: 'chikorita', nameCH: '菊草葉', nameEN: 'Chikorita'},
                    {id: 153, name: 'bayleef', nameCH: '月桂葉', nameEN: 'Bayleef'},
                    {id: 154, name: 'meganium', nameCH: '大竺葵', nameEN: 'Meganium'},
                    {id: 182, name: 'bellossom', nameCH: '美麗花', nameEN: 'Bellossom'},
                    {id: 187, name: 'hoppip', nameCH: '毽子草', nameEN: 'Hoppip'},
                    {id: 191, name: 'sunkern', nameCH: '向日種子', nameEN: 'Sunkern'}
                ]
            },
            electric: {
                name: '電系',
                color: '#feca57',
                pokemon: [
                    {id: 25, name: 'pikachu', nameCH: '皮卡丘', nameEN: 'Pikachu'},
                    {id: 26, name: 'raichu', nameCH: '雷丘', nameEN: 'Raichu'},
                    {id: 81, name: 'magnemite', nameCH: '小磁怪', nameEN: 'Magnemite'},
                    {id: 82, name: 'magneton', nameCH: '三合一磁怪', nameEN: 'Magneton'},
                    {id: 100, name: 'voltorb', nameCH: '雷電球', nameEN: 'Voltorb'},
                    {id: 101, name: 'electrode', nameCH: '頑皮雷彈', nameEN: 'Electrode'},
                    {id: 125, name: 'electabuzz', nameCH: '電擊獸', nameEN: 'Electabuzz'},
                    {id: 135, name: 'jolteon', nameCH: '雷伊布', nameEN: 'Jolteon'},
                    {id: 145, name: 'zapdos', nameCH: '閃電鳥', nameEN: 'Zapdos'},
                    {id: 172, name: 'pichu', nameCH: '皮丘', nameEN: 'Pichu'},
                    {id: 179, name: 'mareep', nameCH: '咩利羊', nameEN: 'Mareep'},
                    {id: 180, name: 'flaaffy', nameCH: '茸茸羊', nameEN: 'Flaaffy'},
                    {id: 181, name: 'ampharos', nameCH: '電龍', nameEN: 'Ampharos'},
                    {id: 239, name: 'elekid', nameCH: '電擊怪', nameEN: 'Elekid'},
                    {id: 243, name: 'raikou', nameCH: '雷公', nameEN: 'Raikou'},
                    {id: 309, name: 'electrike', nameCH: '落雷獸', nameEN: 'Electrike'},
                    {id: 310, name: 'manectric', nameCH: '雷電獸', nameEN: 'Manectric'},
                    {id: 311, name: 'plusle', nameCH: '正電拍拍', nameEN: 'Plusle'},
                    {id: 312, name: 'minun', nameCH: '負電拍拍', nameEN: 'Minun'},
                    {id: 466, name: 'electivire', nameCH: '電擊魔獸', nameEN: 'Electivire'}
                ]
            },
            legendary: {
                name: '神話種',
                color: '#9b59b6',
                pokemon: [
                    {id: 144, name: 'articuno', nameCH: '急凍鳥', nameEN: 'Articuno'},
                    {id: 145, name: 'zapdos', nameCH: '閃電鳥', nameEN: 'Zapdos'},
                    {id: 146, name: 'moltres', nameCH: '火焰鳥', nameEN: 'Moltres'},
                    {id: 150, name: 'mewtwo', nameCH: '超夢', nameEN: 'Mewtwo'},
                    {id: 151, name: 'mew', nameCH: '夢幻', nameEN: 'Mew'},
                    {id: 243, name: 'raikou', nameCH: '雷公', nameEN: 'Raikou'},
                    {id: 244, name: 'entei', nameCH: '炎帝', nameEN: 'Entei'},
                    {id: 245, name: 'suicune', nameCH: '水君', nameEN: 'Suicune'},
                    {id: 249, name: 'lugia', nameCH: '洛奇亞', nameEN: 'Lugia'},
                    {id: 250, name: 'ho-oh', nameCH: '鳳王', nameEN: 'Ho-Oh'},
                    {id: 251, name: 'celebi', nameCH: '時拉比', nameEN: 'Celebi'},
                    {id: 380, name: 'latias', nameCH: '拉帝亞斯', nameEN: 'Latias'},
                    {id: 381, name: 'latios', nameCH: '拉帝歐斯', nameEN: 'Latios'},
                    {id: 382, name: 'kyogre', nameCH: '蓋歐卡', nameEN: 'Kyogre'},
                    {id: 383, name: 'groudon', nameCH: '固拉多', nameEN: 'Groudon'},
                    {id: 384, name: 'rayquaza', nameCH: '烈空坐', nameEN: 'Rayquaza'},
                    {id: 385, name: 'jirachi', nameCH: '基拉祈', nameEN: 'Jirachi'},
                    {id: 386, name: 'deoxys', nameCH: '代歐奇希斯', nameEN: 'Deoxys'},
                    {id: 483, name: 'dialga', nameCH: '帝牙盧卡', nameEN: 'Dialga'},
                    {id: 484, name: 'palkia', nameCH: '帕路奇亞', nameEN: 'Palkia'}
                ]
            }
        };
        
        // 收集進度
        let collection = {
            fire: [],
            water: [], 
            grass: [],
            electric: [],
            legendary: []
        };
        
        // 獲取寶可夢圖片URL - 使用多重備案
        function getPokemonImageURL(id, isOfficial = true) {
            const paddedId = String(id).padStart(3, '0');
            if (isOfficial) {
                return `https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/${paddedId}.png`;
            }
            return `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
        }
        
        // 處理圖片載入錯誤的函數
        function handleImageError(img, id) {
            if (img.src.includes('HybridShivam')) {
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`;
            } else if (img.src.includes('sprites/pokemon')) {
                img.src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/${id}.png`;
            } else {
                img.style.display = 'none';
                img.parentElement.innerHTML += '<div style="font-size: 1rem;">❓</div>';
            }
        }
        
        // 初始化題目池
        function initQuestionPool() {
            questionPool = [];
            for (let i = 1; i <= 9; i++) {
                for (let j = 1; j <= 9; j++) {
                    questionPool.push({
                        num1: i,
                        num2: j,
                        answer: i * j
                    });
                }
            }
            // 打亂題目順序
            shuffleArray(questionPool);
        }
        
        // 打亂陣列順序
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // 語言切換功能
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
            updateLanguage();
            localStorage.setItem('gameLanguage', currentLanguage);
        }
        
        function updateLanguage() {
            // 更新按鈕文字
            const langBtn = document.getElementById('langBtn');
            langBtn.textContent = currentLanguage === 'zh' ? '🌐 EN' : '🌐 中文';
            
            // 更新所有帶有data-zh和data-en屬性的元素
            document.querySelectorAll('[data-zh][data-en]').forEach(element => {
                const text = currentLanguage === 'zh' ? element.getAttribute('data-zh') : element.getAttribute('data-en');
                element.textContent = text;
            });
            
            // 更新placeholder
            document.querySelectorAll('[data-zh-placeholder][data-en-placeholder]').forEach(element => {
                const placeholder = currentLanguage === 'zh' ? element.getAttribute('data-zh-placeholder') : element.getAttribute('data-en-placeholder');
                element.placeholder = placeholder;
            });
            
            // 重新渲染收集進度（更新類型名稱）
            renderCollection();
        }
        
        function getMessage(key, params = {}) {
            let message = translations.messages[currentLanguage][key] || key;
            // 替換參數
            Object.keys(params).forEach(param => {
                message = message.replace(`{${param}}`, params[param]);
            });
            return message;
        }
        
        function getTypeName(typeKey) {
            return translations.types[currentLanguage][typeKey] || typeKey;
        }
        
        // 初始化遊戲
        function initGame() {
            // 載入語言設定
            const savedLanguage = localStorage.getItem('gameLanguage');
            if (savedLanguage) {
                currentLanguage = savedLanguage;
            }
            updateLanguage();
            
            initQuestionPool();
            generateQuestion();
            updateStats();
            renderCollection();
            
            document.getElementById('answerInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        }
        
        // 生成問題 - 均勻模式
        function generateQuestion() {
            // 如果題目池用完了，重新初始化
            if (questionPool.length === 0) {
                initQuestionPool();
                usedQuestions = [];
                showMessage(getMessage('roundComplete'), 'correct');
                setTimeout(() => {
                    document.getElementById('message').style.display = 'none';
                }, 3000);
            }
            
            // 從題目池中取出一個題目
            const questionIndex = Math.floor(Math.random() * questionPool.length);
            currentQuestion = questionPool[questionIndex];
            
            // 將題目從池中移除，加入已用題目
            questionPool.splice(questionIndex, 1);
            usedQuestions.push(currentQuestion);
            
            document.getElementById('questionText').textContent = `${currentQuestion.num1} × ${currentQuestion.num2} = ?`;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
        }
        
        // 檢查答案
        function checkAnswer() {
            const userAnswer = parseInt(document.getElementById('answerInput').value);
            
            if (isNaN(userAnswer)) {
                showMessage(getMessage('inputNumber'), 'incorrect');
                return;
            }
            
            if (userAnswer === currentQuestion.answer) {
                stats.correct++;
                showMessage(getMessage('correct'), 'correct');
                rewardPokemon();
                setTimeout(generateQuestion, 2500);
            } else {
                showMessage(getMessage('incorrect') + ' ' + currentQuestion.answer, 'incorrect');
                setTimeout(() => {
                    document.getElementById('message').style.display = 'none';
                    generateQuestion(); // 答錯後自動換下一題
                }, 2000);
            }
            
            updateStats();
        }
        
        // 顯示訊息
        function showMessage(text, type) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
        }
        
        // 獎勵寶可夢
        function rewardPokemon() {
            let randomType;
            
            // 神話種獲得條件：機率降低+冷卻機制
            const sinceLast = stats.correct - lastLegendaryCount;
            const cooldownPassed = lastLegendaryCount === -1 || sinceLast >= 3; // 至少間隔3題
            
            const canGetLegendary = cooldownPassed && collection.legendary.length < 5 && (
                (stats.correct >= 5 && Math.random() < 0.10) ||   // 5題後10%機率
                (stats.correct >= 15 && Math.random() < 0.20) ||  // 15題後20%機率
                (stats.correct >= 30 && Math.random() < 0.30)     // 30題後30%機率
            );
            
            if (canGetLegendary) {
                randomType = 'legendary';
                lastLegendaryCount = stats.correct; // 記錄獲得神話種的題數
            } else {
                // 普通類型隨機選擇
                const normalTypes = ['fire', 'water', 'grass', 'electric'];
                randomType = normalTypes[Math.floor(Math.random() * normalTypes.length)];
            }
            
            const typeData = pokemonTypes[randomType];
            
            // 找到該屬性還沒收集的寶可夢
            const availablePokemon = typeData.pokemon.filter(p => 
                !collection[randomType].some(collected => collected.id === p.id)
            );
            
            if (availablePokemon.length > 0) {
                const pokemon = availablePokemon[Math.floor(Math.random() * availablePokemon.length)];
                collection[randomType].push(pokemon);
                stats.pokemon++;
                
                showPokemon(pokemon, randomType);
                
                // 檢查是否完成該屬性收集（每收集5隻獲得1顆星星）
                if (collection[randomType].length % 5 === 0) {
                    stats.stars++;
                    const starNumber = collection[randomType].length / 5;
                    setTimeout(() => {
                        const starMessage = randomType === 'legendary' ? 
                            getMessage('legendaryStarEarned', {stage: starNumber}) : 
                            getMessage('starEarned', {type: getTypeName(randomType), stage: starNumber});
                        showMessage(starMessage, 'correct');
                    }, 1500);
                }
                
                renderCollection();
            }
        }
        
        // 顯示獲得的寶可夢
        function showPokemon(pokemon, type) {
            const rewardEl = document.getElementById('pokemonReward');
            const typeData = pokemonTypes[type];
            const isLegendary = type === 'legendary';
            
            // 如果是神話種，先顯示特殊訊息
            if (isLegendary) {
                showMessage(getMessage('legendary'), 'correct');
            }
            
            const legendaryClass = isLegendary ? 'legendary' : '';
            const starsHtml = isLegendary ? `
                <div class="legendary-stars">
                    <div class="legendary-star" style="top: 10%; left: 20%;">✨</div>
                    <div class="legendary-star" style="top: 15%; right: 25%;">⭐</div>
                    <div class="legendary-star" style="top: 30%; left: 10%;">🌟</div>
                    <div class="legendary-star" style="top: 35%; right: 15%;">✨</div>
                    <div class="legendary-star" style="top: 50%; left: 30%;">⭐</div>
                    <div class="legendary-star" style="top: 55%; right: 30%;">🌟</div>
                    <div class="legendary-star" style="top: 70%; left: 15%;">✨</div>
                    <div class="legendary-star" style="top: 75%; right: 20%;">⭐</div>
                </div>
            ` : '';
            
            rewardEl.innerHTML = `
                <div class="pokemon-card ${legendaryClass}" id="newPokemon">
                    ${starsHtml}
                    <img src="${getPokemonImageURL(pokemon.id)}" 
                         alt="${currentLanguage === 'zh' ? pokemon.nameCH : pokemon.nameEN}" 
                         class="pokemon-image" 
                         onerror="handleImageError(this, ${pokemon.id})">
                    <div class="pokemon-name">${currentLanguage === 'zh' ? pokemon.nameCH : pokemon.nameEN}</div>
                    <div class="pokemon-type" style="background-color: ${typeData.color}">
                        ${isLegendary ? '🌟 ' : ''}${getTypeName(type)}
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                const card = document.getElementById('newPokemon');
                if (card) card.classList.add('show');
            }, 100);
            
            // 神話種顯示更長時間
            const displayTime = isLegendary ? 5000 : 3500;
            setTimeout(() => {
                rewardEl.innerHTML = '';
            }, displayTime);
        }
        
        // 更新統計
        function updateStats() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('progressCount').textContent = usedQuestions.length;
            document.getElementById('pokemonCount').textContent = stats.pokemon;
            document.getElementById('starCount').textContent = stats.stars;
        }
        
        // 渲染收集進度
        function renderCollection() {
            const container = document.getElementById('typeCollections');
            container.innerHTML = '';
            
            Object.keys(pokemonTypes).forEach(typeKey => {
                const typeData = pokemonTypes[typeKey];
                const collected = collection[typeKey];
                const completedStages = Math.floor(collected.length / 5);
                const currentProgress = collected.length % 5;
                const isComplete = collected.length >= 5;
                const isLegendary = typeKey === 'legendary';
                
                const div = document.createElement('div');
                div.className = `type-collection ${isComplete ? 'complete' : ''} ${isLegendary ? 'legendary' : ''}`;
                
                // 顯示所有寶可夢，已收集的不灰化
                const pokemonHtml = typeData.pokemon.map(pokemon => {
                    const isCollected = collected.some(c => c.id === pokemon.id);
                    const paddedId = String(pokemon.id).padStart(3, '0');
                    const pokemonName = currentLanguage === 'zh' ? pokemon.nameCH : pokemon.nameEN;
                    return `<img src="https://raw.githubusercontent.com/HybridShivam/Pokemon/master/assets/images/${paddedId}.png" 
                                 alt="${pokemonName}" 
                                 class="pokemon-mini ${isCollected ? 'collected' : ''}" 
                                 title="${pokemonName}"
                                 onerror="handleImageError(this, ${pokemon.id})">`;
                }).join('');
                
                // 顯示階段進度和獲得的星星
                let statusText = '';
                if (completedStages > 0) {
                    const starIcon = isLegendary ? '🌟' : '⭐';
                    const messageKey = isLegendary ? 'legendaryStarsEarned' : 'starsEarned';
                    statusText = `<div style="margin-top: 8px; font-size: 1rem; font-weight: bold;">${getMessage(messageKey, {count: completedStages})}</div>`;
                }
                
                div.innerHTML = `
                    <div class="type-header" style="color: ${isLegendary ? 'white' : typeData.color}">
                        ${getTypeName(typeKey)} (${collected.length}/${(completedStages + 1) * 5})
                    </div>
                    <div class="pokemon-grid">${pokemonHtml}</div>
                    ${statusText}
                `;
                
                container.appendChild(div);
            });
            
            // 渲染星星
            const starsEl = document.getElementById('starsDisplay');
            starsEl.innerHTML = Array(stats.stars).fill(0).map(() => '<span class="star">⭐</span>').join('');
        }
        
        // 啟動遊戲
        initGame();
    </script>
</body>
</html>